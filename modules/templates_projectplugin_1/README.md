# The Secret Order of Templates - Project Plugin Template

Minimalistic plugin, that can be used as a template for writing plugins.

Taking the opportunity let us clarify the difference between words "plugin" and
"module", which can be sometimes used interchangeably. Plugin is a module, which
implements cutehmi::IProjectPlugin interface, which enables it to be loaded on
demand and form its own project node. All plugins are modules, but not
necessarily all modules are plugins. This module is a plugin, because it
implements cutehmi::IProjectPlugin interface.

This template builds on [templates_minimal_1](../templates_minimal_1/).
Everything that applies to [templates_minimal_1](../templates_minimal_1/),
applies to this template as well. Only distinct additions will be described
here.


## Directories

Compared to [templates_minimal_1](../templates_minimal_1/), this module uses
`plugin` subdirectory, which was mentioned, but did not exist in
[templates_minimal_1](../templates_minimal_1/) module.


## Files

There are four additional files located in `plugin` subdirectory, which you
need to edit.


### [src/templates/projectplugin/plugin/PluginNodeData.hpp]

Typically when plugin is initialized it wants to initialize some data as well.
It also wants to keep this data alive for the duration of its own lifespan.
This can be easily accomplished with the help of cutehmi::DataBlock class, which
can live in a project tree (see cutehmi::ProjectModel) and maintains lifetime of
its members.

```cpp
class PluginNodeData:
    public cutehmi::DataBlock
{
    public:
        PluginNodeData();

        YourData * yourData() const;

    private:
        std::unique_ptr<YourData> m_yourData;
};
```
Class cutehmi::DataBlock is non-copyable, but movable, so it is convenient to
keep members inside std::unique_ptr, which takes care about move semantics. You
may need to provide custom constructor to pass data members initialized outside
the class. You may also want to provide your own accessor methods to use the
data elsewhere.


### [src/templates/projectplugin/plugin/PluginNodeData.cpp]

This file keeps implementation of PluginNodeData.


### [src/templates/projectplugin/plugin/ProjectPlugin.hpp]

This file defines ProjectPlugin class, which implements cutehmi::IProjectPlugin
interface.

```cpp
class ProjectPlugin:
    public QObject,
    public cutehmi::IProjectPlugin
{
    Q_OBJECT
    Q_PLUGIN_METADATA(IID CUTEHMI_IPROJECTPLUGIN_IID FILE "../../../../cutehmi.metadata.json")
    Q_INTERFACES(cutehmi::IProjectPlugin)
```
This uses [Low-Level API](http://doc.qt.io/qt-5/plugins-howto.html#the-low-level-api-extending-qt-applications)
for extending Qt applications. File `cutehmi.metadata.json` should be
autogenerated from `.qbs` file by `cutehmi.metadata` Qbs module.

```cpp
    void init(cutehmi::ProjectNode & node) override;
```
This is the method that needs to be implemented to satisfy
cutehmi::IProjectPlugin interface. During initialization you receive a
cutehmi::ProjectNode instance. This object can be used in various ways, but
typically a plugin will use it to push some data to a project tree or register
some extensions. A plugin may also append child nodes to this node.


### [src/templates/projectplugin/plugin/ProjectPlugin.cpp]

This file keeps implementation of ProjectPlugin::init.

```cpp
void ProjectPlugin::init(cutehmi::ProjectNode & node)
{
    std::unique_ptr<PluginNodeData> pluginNodeData(new PluginNodeData);
    node.data().append(std::move(pluginNodeData));
}
```
In this implementation an instance of PluginNodeData class is created. Instance
of PluginNodeData is then appended to the default node data, which is kept
inside a project tree.


## Extended template

This template can be used as a base to create plugins.
[XML Backend Template](../templates_xmlbackend_1/) is provided for plugins that
can be configured with XML project file.

[src/templates/projectplugin/plugin/ProjectPlugin.hpp]: ../../modules/templates_projectplugin_1/src/templates/projectplugin/plugin/ProjectPlugin.hpp
[src/templates/projectplugin/plugin/ProjectPlugin.cpp]: ../../modules/templates_projectplugin_1/src/templates/projectplugin/plugin/ProjectPlugin.cpp
[src/templates/projectplugin/plugin/PluginNodeData.hpp]: ../../modules/templates_projectplugin_1/src/templates/projectplugin/plugin/PluginNodeData.hpp
[src/templates/projectplugin/plugin/PluginNodeData.cpp]: ../../modules/templates_projectplugin_1/src/templates/projectplugin/plugin/PluginNodeData.cpp
